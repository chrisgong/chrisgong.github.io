<!doctype html>



  


<html class="theme-next mist use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"/>




  <link href="//fonts.googleapis.com/css?family=Lato:300,400,700,400italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">



<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=0.5.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Android,AndroidAnnotations," />





  <link rel="alternate" href="/atom.xml" title="Gc's blog" type="application/atom+xml" />




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=0.5.0" />






<meta name="description" content="Defining the preferencesFirst, you should create an interface annotated with @SharedPref to define the SharedPreferences :
@SharedPrefpublic interface MyPrefs &amp;#123;        // The field name will have">
<meta property="og:type" content="article">
<meta property="og:title" content="AndroidAnnotations (八) - SharedPreferences">
<meta property="og:url" content="http://gcblog.cn/2015/11/25/AndroidAnnotations-八-SharedPreferences/index.html">
<meta property="og:site_name" content="Gc's blog">
<meta property="og:description" content="Defining the preferencesFirst, you should create an interface annotated with @SharedPref to define the SharedPreferences :
@SharedPrefpublic interface MyPrefs &amp;#123;        // The field name will have">
<meta property="og:updated_time" content="2016-03-06T05:38:40.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="AndroidAnnotations (八) - SharedPreferences">
<meta name="twitter:description" content="Defining the preferencesFirst, you should create an interface annotated with @SharedPref to define the SharedPreferences :
@SharedPrefpublic interface MyPrefs &amp;#123;        // The field name will have">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Mist',
    sidebar: {"position":"right","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 0,
      author: '博主'
    }
  };
</script>

  <title> AndroidAnnotations (八) - SharedPreferences | Gc's blog </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  








  
  
    
  

  <div class="container one-collumn sidebar-position-right page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">Gc's blog</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">Discontent is the first step in progress.</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu menu-left">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-home fa-fw"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-th fa-fw"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-archive fa-fw"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-tags fa-fw"></i> <br />
            
            标签
          </a>
        </li>
      

      


      
      
    </ul>
  

  
    <div class="site-search">
      
  <form class="site-search-form">
  <input type="text" id="st-search-input" class="st-search-input st-default-search-input" />
</form>

<script type="text/javascript">
  (function(w,d,t,u,n,s,e){w['SwiftypeObject']=n;w[n]=w[n]||function(){
    (w[n].q=w[n].q||[]).push(arguments);};s=d.createElement(t);
    e=d.getElementsByTagName(t)[0];s.async=1;s.src=u;e.parentNode.insertBefore(s,e);
  })(window,document,'script','//s.swiftypecdn.com/install/v2/st.js','_st');

  _st('install', 'PYs42SgQqvuLRSDRespH','2.0.0');
</script>



    </div>
  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                AndroidAnnotations (八) - SharedPreferences
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2015-11-25T08:11:04+08:00" content="2015-11-25">
              2015-11-25
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2015/11/25/AndroidAnnotations-八-SharedPreferences/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2015/11/25/AndroidAnnotations-八-SharedPreferences/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <h3 id="Defining-the-preferences"><a href="#Defining-the-preferences" class="headerlink" title="Defining the preferences"></a>Defining the preferences</h3><p>First, you should create an interface annotated with <code>@SharedPref</code> to define the SharedPreferences :</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="annotation">@SharedPref</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">MyPrefs</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// The field name will have default value “John”</span></span><br><span class="line">    <span class="annotation">@DefaultString</span>(<span class="string">“John”</span>)</span><br><span class="line">    <span class="function">String <span class="title">name</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// The field age will have default value 42</span></span><br><span class="line">    <span class="annotation">@DefaultInt</span>(<span class="number">42</span>)</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">age</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// The field lastUpdated will have default value 0</span></span><br><span class="line">    <span class="function"><span class="keyword">long</span> <span class="title">lastUpdated</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Based on that specification, AndroidAnnotations builds a SharedPreferences Helper that has the same name plus an underscore. You can get an instance of the generated helper in any enhanced class with the <code>@Pref</code> annotation.</p>
<p><strong>Important</strong>: The type of the field <strong>MUST</strong> be the generated class instead of the source class. It’s the only exception in AA.</p>
<figure class="highlight scala"><table><tr><td class="code"><pre><span class="line"><span class="annotation">@EActivity</span></span><br><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">MyActivity</span> <span class="keyword"><span class="keyword">extends</span></span> <span class="title">Activity</span> &#123;</span></span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Pref</span></span><br><span class="line">    <span class="type">MyPrefs_</span> myPrefs;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// …</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>You can then start using it:</p>
<figure class="highlight processing"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Simple edit</span></span><br><span class="line">myPrefs.name().put(<span class="string">“John”</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Batch edit</span></span><br><span class="line">myPrefs.edit()</span><br><span class="line">  .name()</span><br><span class="line">  .put(<span class="string">“John”</span>)</span><br><span class="line">  .age()</span><br><span class="line">  .put(<span class="number">42</span>)</span><br><span class="line">  .apply();</span><br><span class="line"></span><br><span class="line"><span class="comment">// Preference clearing:</span></span><br><span class="line">myPrefs.<span class="built_in">clear</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// Check if a value exists:</span></span><br><span class="line"><span class="built_in">boolean</span> nameExists = myPrefs.name().exists();</span><br><span class="line"></span><br><span class="line"><span class="comment">// Reading a value</span></span><br><span class="line"><span class="keyword">long</span> lastUpdated = myPrefs.lastUpdated().<span class="built_in">get</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// Reading a value and providing a fallback default value</span></span><br><span class="line"><span class="keyword">long</span> now = System.currentTimeMillis();</span><br><span class="line"><span class="keyword">long</span> lastUpdated = myPrefs.lastUpdated().getOr(now);</span><br></pre></td></tr></table></figure>

<h3 id="Default-resource-value"><a href="#Default-resource-value" class="headerlink" title="Default resource value"></a>Default resource value</h3><blockquote>
<p>Since AndroidAnnotations 3.0</p>
</blockquote>
<p>It’s now possible to inject a default value from Android resources with <code>@DefaultRes</code>:</p>
<figure class="highlight autoit"><table><tr><td class="code"><pre><span class="line"><span class="constant">@SharedPref</span></span><br><span class="line">public interface MyPrefs &#123;</span><br><span class="line">    <span class="constant">@DefaultRes</span>(R.<span class="built_in">string</span>.defaultPrefName)</span><br><span class="line">    <span class="built_in">String</span> resourceName()<span class="comment">;</span></span><br><span class="line"></span><br><span class="line">    <span class="constant">@DefaultRes</span> // uses <span class="string">‘R.string.defaultPrefAge’</span> <span class="keyword">to</span> set <span class="keyword">default</span> value</span><br><span class="line">    <span class="built_in">String</span> defaultPrefAge()<span class="comment">;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="String-resource-as-preference-key"><a href="#String-resource-as-preference-key" class="headerlink" title="String resource as preference key"></a>String resource as preference key</h3><blockquote>
<p>Since AndroidAnnotations 3.1</p>
</blockquote>
<p>You can specify a String resource by its id to be used as the preference key instead of the method name. This is useful when you specify your preferences in an xml file, and you use String resource keys there. Example:</p>
<figure class="highlight cs"><table><tr><td class="code"><pre><span class="line">@SharedPref</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title">MyPrefs</span> &#123;</span><br><span class="line">    @DefaultString(<span class="keyword">value</span> = <span class="string">“John”</span>, keyRes = R.<span class="keyword">string</span>.myPrefKey)</span><br><span class="line">    <span class="function">String <span class="title">name</span>(<span class="params"></span>)</span>;</span><br><span class="line"></span><br><span class="line">    @DefaultRes(keyRes = R.<span class="keyword">string</span>.myOtherPrefKey)</span><br><span class="line">    <span class="function">String <span class="title">defaultPrefAge</span>(<span class="params"></span>)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Scope"><a href="#Scope" class="headerlink" title="Scope"></a>Scope</h3><p>Observe that you can name the shared preference by setting <code>value</code> to one of the following:</p>
<ul>
<li><code>ACTIVITY</code>, for a shared preference named <code>MyActivity_MyPrefs</code>;</li>
<li><code>ACTIVITY_DEFAULT</code>, for a shared preference named <code>MyActivity</code> (also available through <code>activity.getPreferences()</code>);</li>
<li><code>APPLICATION_DEFAULT</code>, for the default <code>SharedPreference</code> or <code>UNIQUE</code>, for a shared preference named <code>MyPrefs</code>.<br>Therefore, if a single shared preference is needed for the interface defined, in order to all activities of a given application to share the same preferences, the following should be used:<figure class="highlight cs"><table><tr><td class="code"><pre><span class="line">@SharedPref(<span class="keyword">value</span>=SharedPref.Scope.UNIQUE)</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title">MyPrefs</span> &#123;</span><br><span class="line">…</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="Using-it-with-a-PreferenceActivity"><a href="#Using-it-with-a-PreferenceActivity" class="headerlink" title="Using it with a PreferenceActivity"></a>Using it with a <code>PreferenceActivity</code></h3><p>The Android <code>PreferenceActivity</code> or <code>PreferenceFragment</code> can edit the values of your shared preferences.</p>
<figure class="highlight groovy"><table><tr><td class="code"><pre><span class="line"><span class="annotation">@SharedPref</span>(SharedPref.Scope.UNIQUE)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">MyPrefs</span> &#123;</span></span><br><span class="line">…</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br><figure class="highlight processing"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">String</span> PREF_NAME = <span class="string">“MyPrefs”</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// in onCreate</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Using your MyPrefs values </span></span><br><span class="line"><span class="keyword">this</span>.getPreferenceManager().setSharedPreferencesName(PREF_NAME);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Opening the layout </span></span><br><span class="line">addPreferencesFromResource(R.xml.prefs);</span><br></pre></td></tr></table></figure>
      
    </div>

    <div>
      
        
      
    </div>

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Android/" rel="tag">#Android</a>
          
            <a href="/tags/AndroidAnnotations/" rel="tag">#AndroidAnnotations</a>
          
        </div>
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2015/11/25/AndroidAnnotations-七-Thread/" rel="next" title="AndroidAnnotations (七) - Thread">
                <i class="fa fa-chevron-left"></i> AndroidAnnotations (七) - Thread
              </a>
            
          </div>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2015/11/25/AndroidAnnotations-十-Trace/" rel="prev" title="AndroidAnnotations (十) - Trace">
                AndroidAnnotations (十) - Trace <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
        <div class="ds-share flat" data-thread-key="2015/11/25/AndroidAnnotations-八-SharedPreferences/"
     data-title="AndroidAnnotations (八) - SharedPreferences"
     data-content=""
     data-url="http://gcblog.cn/2015/11/25/AndroidAnnotations-八-SharedPreferences/">
  <div class="ds-share-inline">
    <ul  class="ds-share-icons-16">

      <li data-toggle="ds-share-icons-more"><a class="ds-more" href="javascript:void(0);">分享到：</a></li>
      <li><a class="ds-weibo" href="javascript:void(0);" data-service="weibo">微博</a></li>
      <li><a class="ds-qzone" href="javascript:void(0);" data-service="qzone">QQ空间</a></li>
      <li><a class="ds-qqt" href="javascript:void(0);" data-service="qqt">腾讯微博</a></li>
      <li><a class="ds-wechat" href="javascript:void(0);" data-service="wechat">微信</a></li>

    </ul>
    <div class="ds-share-icons-more">
    </div>
  </div>
</div>
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
      <div class="ds-thread" data-thread-key="2015/11/25/AndroidAnnotations-八-SharedPreferences/"
           data-title="AndroidAnnotations (八) - SharedPreferences" data-url="http://gcblog.cn/2015/11/25/AndroidAnnotations-八-SharedPreferences/">
      </div>
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/default_avatar.jpg"
               alt="Gc" />
          <p class="site-author-name" itemprop="name">Gc</p>
          <p class="site-description motion-element" itemprop="description">Discontent is the first step in progress.</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">25</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>
          
          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">1</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">9</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/chrisgong" target="_blank">
                  
                    <i class="fa fa-github"></i> GitHub
                  
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://weibo.com/u/1916380757" target="_blank">
                  
                    <i class="fa fa-weibo"></i> Weibo
                  
                </a>
              </span>
            
          
        </div>

        
        

        <div class="links-of-author motion-element">
          
        </div>

      </section>

      
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc-indicator-top post-toc-indicator">
            <i class="fa fa-angle-double-up"></i>
          </div>
          <div class="post-toc">
            
              
            
            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#Defining-the-preferences"><span class="nav-number">1.</span> <span class="nav-text">Defining the preferences</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Default-resource-value"><span class="nav-number">2.</span> <span class="nav-text">Default resource value</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#String-resource-as-preference-key"><span class="nav-number">3.</span> <span class="nav-text">String resource as preference key</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Scope"><span class="nav-number">4.</span> <span class="nav-text">Scope</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Using-it-with-a-PreferenceActivity"><span class="nav-number">5.</span> <span class="nav-text">Using it with a PreferenceActivity</span></a></li></ol></div>
            
          </div>
          <div class="post-toc-indicator-bottom post-toc-indicator">
            <i class="fa fa-angle-double-down"></i>
          </div>
        </section>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy;  2015 - 
  <span itemprop="copyrightYear">2016</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Gc</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="http://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>



      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  


  




<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  <script type="text/javascript" src="/vendors/velocity/velocity.min.js"></script>

  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js"></script>

  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=0.5.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=0.5.0"></script>



  
  

  
  
<script type="text/javascript" src="/js/src/scrollspy.js?v=0.5.0"></script>

<script type="text/javascript" id="sidebar.toc.highlight">
  $(document).ready(function () {
    var tocSelector = '.post-toc';
    var $tocSelector = $(tocSelector);
    var activeCurrentSelector = '.active-current';

    $tocSelector
      .on('activate.bs.scrollspy', function () {
        var $currentActiveElement = $(tocSelector + ' .active').last();

        removeCurrentActiveClass();
        $currentActiveElement.addClass('active-current');

        $tocSelector[0].scrollTop = $currentActiveElement.position().top;
      })
      .on('clear.bs.scrollspy', function () {
        removeCurrentActiveClass();
      });

    function removeCurrentActiveClass () {
      $(tocSelector + ' ' + activeCurrentSelector)
        .removeClass(activeCurrentSelector.substring(1));
    }

    function processTOC () {
      getTOCMaxHeight();
      toggleTOCOverflowIndicators();
    }

    function getTOCMaxHeight () {
      var height = $('.sidebar').height() -
                   $tocSelector.position().top -
                   $('.post-toc-indicator-bottom').height();

      $tocSelector.css('height', height);

      return height;
    }

    function toggleTOCOverflowIndicators () {
      tocOverflowIndicator(
        '.post-toc-indicator-top',
        $tocSelector.scrollTop() > 0 ? 'show' : 'hide'
      );

      tocOverflowIndicator(
        '.post-toc-indicator-bottom',
        $tocSelector.scrollTop() >= $tocSelector.find('ol').height() - $tocSelector.height() ? 'hide' : 'show'
      )
    }

    $(document).on('sidebar.motion.complete', function () {
      processTOC();
    });

    $('body').scrollspy({ target: tocSelector });
    $(window).on('resize', function () {
      if ( $('.sidebar').hasClass('sidebar-active') ) {
        processTOC();
      }
    });

    onScroll($tocSelector);

    function onScroll (element) {
      element.on('mousewheel DOMMouseScroll', function (event) {
          var oe = event.originalEvent;
          var delta = oe.wheelDelta || -oe.detail;

          this.scrollTop += ( delta < 0 ? 1 : -1 ) * 30;
          event.preventDefault();

          toggleTOCOverflowIndicators();
      });
    }

    function tocOverflowIndicator (indicator, action) {
      var $indicator = $(indicator);
      var opacity = action === 'show' ? 1 : 0;
      $indicator.velocity ?
        $indicator.velocity('stop').velocity({
          opacity: opacity
        }, { duration: 100 }) :
        $indicator.stop().animate({
          opacity: opacity
        }, 100);
    }

  });
</script>

<script type="text/javascript" id="sidebar.nav">
  $(document).ready(function () {
    var html = $('html');
    var TAB_ANIMATE_DURATION = 200;
    var hasVelocity = $.isFunction(html.velocity);

    $('.sidebar-nav li').on('click', function () {
      var item = $(this);
      var activeTabClassName = 'sidebar-nav-active';
      var activePanelClassName = 'sidebar-panel-active';
      if (item.hasClass(activeTabClassName)) {
        return;
      }

      var currentTarget = $('.' + activePanelClassName);
      var target = $('.' + item.data('target'));

      hasVelocity ?
        currentTarget.velocity('transition.slideUpOut', TAB_ANIMATE_DURATION, function () {
          target
            .velocity('stop')
            .velocity('transition.slideDownIn', TAB_ANIMATE_DURATION)
            .addClass(activePanelClassName);
        }) :
        currentTarget.animate({ opacity: 0 }, TAB_ANIMATE_DURATION, function () {
          currentTarget.hide();
          target
            .stop()
            .css({'opacity': 0, 'display': 'block'})
            .animate({ opacity: 1 }, TAB_ANIMATE_DURATION, function () {
              currentTarget.removeClass(activePanelClassName);
              target.addClass(activePanelClassName);
            });
        });

      item.siblings().removeClass(activeTabClassName);
      item.addClass(activeTabClassName);
    });

    $('.post-toc a').on('click', function (e) {
      e.preventDefault();
      var targetSelector = NexT.utils.escapeSelector(this.getAttribute('href'));
      var offset = $(targetSelector).offset().top;
      hasVelocity ?
        html.velocity('stop').velocity('scroll', {
          offset: offset  + 'px',
          mobileHA: false
        }) :
        $('html, body').stop().animate({
          scrollTop: offset
        }, 500);
    });

    // Expand sidebar on post detail page by default, when post has a toc.
    NexT.motion.middleWares.sidebar = function () {
      var $tocContent = $('.post-toc-content');

      if (CONFIG.scheme !== 'Pisces' && (CONFIG.sidebar.display === 'post' || CONFIG.sidebar.display === 'always')) {
        if ($tocContent.length > 0 && $tocContent.html().trim().length > 0) {
          NexT.utils.displaySidebar();
        }
      }
    };
  });
</script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=0.5.0"></script>



  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"gcblog"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  
    
  





  
  
  

  


</body>
</html>
